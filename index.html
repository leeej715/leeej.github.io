<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Five Elements Finder (Wood/Fire/Earth/Metal/Water)</title>

  <meta name="theme-color" content="#0b0c10" />
  <meta name="apple-mobile-web-app-capable" content="yes" />

  <style>
    :root{
      --bg:#0b0c10;
      --card:#121420;
      --line:#262b44;
      --text:#eaf0ff;
      --muted:#b8c4ff;
      --muted2:#94a3d6;
      --btn:#1b2140;
      --btn2:#10142a;
      --focus:#7aa2ff;
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 0%, #121a3a 0%, transparent 55%),
                  radial-gradient(1000px 500px at 90% 10%, #1b1340 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    .wrap{
      max-width: 860px;
      margin: 0 auto;
      padding: 18px 16px 28px;
    }

    .header{
      display:flex;
      flex-direction: column;
      gap: 6px;
      margin: 10px 0 14px;
    }
    .title{
      font-size: clamp(20px, 4.8vw, 28px);
      font-weight: 820;
      letter-spacing: .2px;
      line-height: 1.15;
      margin:0;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      line-height: 1.4;
      font-size: 14px;
    }

    .card{
      background: color-mix(in oklab, var(--card), #000 10%);
      border: 1px solid color-mix(in oklab, var(--line), #000 15%);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 18px 45px rgba(0,0,0,.32);
      backdrop-filter: blur(6px);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 720px){
      .grid.two{
        grid-template-columns: 1fr 1fr;
      }
    }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 2px 0 8px;
    }

    input[type="date"], input[type="time"]{
      width:100%;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid color-mix(in oklab, var(--line), #000 20%);
      background: var(--btn2);
      color: var(--text);
      font-size: 16px; /* prevent iOS zoom */
      outline: none;
    }
    input[type="date"]:focus, input[type="time"]:focus{
      border-color: color-mix(in oklab, var(--focus), #fff 5%);
      box-shadow: 0 0 0 3px rgba(122,162,255,.20);
    }

    .actions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    button{
      width:100%;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid color-mix(in oklab, var(--line), #000 20%);
      background: var(--btn);
      color: var(--text);
      font-size: 16px;
      font-weight: 800;
      cursor:pointer;
      touch-action: manipulation;
    }
    button.secondary{
      background: rgba(16,20,42,.55);
      font-weight: 750;
      color: var(--muted);
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }

    .result{
      margin-top: 14px;
      padding: 16px;
      border-radius: var(--radius);
      border: 1px dashed color-mix(in oklab, var(--line), #000 10%);
      background: rgba(16,20,42,.55);
      display:none;
    }
    .bigline{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: flex-start;
      justify-content: space-between;
    }
    .big{
      font-size: clamp(22px, 6vw, 34px);
      font-weight: 900;
      letter-spacing: .2px;
      margin:0;
      line-height: 1.05;
    }
    .subbig{
      margin: 8px 0 0;
      font-size: 15px;
      color: var(--muted);
      font-weight: 750;
      line-height: 1.25;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid color-mix(in oklab, var(--line), #000 20%);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size: 13px;
      font-weight: 750;
      white-space: nowrap;
    }

    details{
      margin-top: 12px;
      border-top: 1px solid rgba(38,43,68,.7);
      padding-top: 10px;
    }
    summary{
      cursor:pointer;
      color: var(--muted);
      font-weight: 800;
      font-size: 14px;
      list-style: none;
      outline:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .detail-grid{
      margin-top: 10px;
      display:grid;
      gap: 8px;
      font-size: 14px;
      color: var(--muted);
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; color: var(--text); }

    .note{
      margin-top: 12px;
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1 class="title">Five Elements Finder</h1>
      <p class="subtitle">
        Enter your birth date (and optional time). This simple version uses the <b>Day Stem (Day Master)</b>
        to map to <b>Wood / Fire / Earth / Metal / Water</b>.
      </p>
    </div>

    <div class="card">
      <div class="grid two">
        <div>
          <label for="birthDate">Birth date</label>
          <input id="birthDate" type="date" />
        </div>
        <div>
          <label for="birthTime">Birth time (optional)</label>
          <input id="birthTime" type="time" />
        </div>
      </div>

      <div class="actions">
        <button id="calcBtn">Calculate</button>
        <button id="resetBtn" class="secondary" type="button">Reset</button>
      </div>

      <div id="out" class="result"></div>

      <div class="note">
        Presentation-friendly quick checker. If you enter a time, we‚Äôll also show the Hour Pillar in ‚ÄúDetails‚Äù.
      </div>
    </div>
  </div>

<script>
  // ---- Core data ----
  const STEMS = ["Áî≤","‰πô","‰∏ô","‰∏Å","Êàä","Â∑±","Â∫ö","Ëæõ","Â£¨","Áô∏"];
  const BRANCHES = ["Â≠ê","‰∏ë","ÂØÖ","ÂçØ","Ëæ∞","Â∑≥","Âçà","Êú™","Áî≥","ÈÖâ","Êàå","‰∫•"];

  function mod(n, m){ return ((n % m) + m) % m; }

  // Gregorian date -> Julian Day Number at noon (integer)
  function jdnNoon(y, m, d){
    const a = Math.floor((14 - m) / 12);
    const y2 = y + 4800 - a;
    const m2 = m + 12 * a - 3;
    return d
      + Math.floor((153 * m2 + 2) / 5)
      + 365 * y2
      + Math.floor(y2 / 4)
      - Math.floor(y2 / 100)
      + Math.floor(y2 / 400)
      - 32045;
  }

  // Sexagenary day stem/branch from JD_noon:
  // T = 1 + mod(JD_noon - 1, 10)
  // B = 1 + mod(JD_noon + 1, 12)
  function dayPillarFromDate(y, m, d){
    const jd = jdnNoon(y, m, d);
    const T = 1 + mod(jd - 1, 10);
    const B = 1 + mod(jd + 1, 12);
    return { jd, stemIndex: T, branchIndex: B, pillar: STEMS[T-1] + BRANCHES[B-1] };
  }

  // Element + ‚ÄúBig/Small‚Äù Day Master label (e.g., Big Fire = ‰∏ôÁÅ´)
  function dayMasterInfo(T){
    switch (T){
      case 1: return { element:"Wood", emoji:"üå≥", label:"Big Wood", roman:"Jia", han: "Áî≤Êú®" };
      case 2: return { element:"Wood", emoji:"üå≥", label:"Small Wood", roman:"Yi", han: "‰πôÊú®" };
      case 3: return { element:"Fire", emoji:"üî•", label:"Big Fire", roman:"Bing", han: "‰∏ôÁÅ´" }; // Î≥ëÌôî(ÌÅ∞Î∂à)
      case 4: return { element:"Fire", emoji:"üî•", label:"Small Fire", roman:"Ding", han: "‰∏ÅÁÅ´" };
      case 5: return { element:"Earth", emoji:"ü™®", label:"Big Earth", roman:"Wu", han: "ÊàäÂúü" };
      case 6: return { element:"Earth", emoji:"ü™®", label:"Small Earth", roman:"Ji", han: "Â∑±Âúü" };
      case 7: return { element:"Metal", emoji:"ü™ô", label:"Big Metal", roman:"Geng", han: "Â∫öÈáë" };
      case 8: return { element:"Metal", emoji:"ü™ô", label:"Small Metal", roman:"Xin", han: "ËæõÈáë" };
      case 9: return { element:"Water", emoji:"üíß", label:"Big Water", roman:"Ren", han: "Â£¨Ê∞¥" };
      case 10:return { element:"Water", emoji:"üíß", label:"Small Water", roman:"Gui", han: "Áô∏Ê∞¥" };
      default:return { element:"", emoji:"", label:"", roman:"", han:"" };
    }
  }

  function hourBranchIndex(hour){
    // 23:00‚Äì00:59 => Zi, 01‚Äì02 => Chou ... 21‚Äì22 => Hai
    if (hour === 23 || hour === 0) return 1;  // Â≠ê
    return ((hour + 1) >> 1) + 1;            // 1..22 -> 2..12
  }

  function hourPillar(dayStemIndex, hour){
    // Zi hour stem start depends on day stem group (5 Rat method)
    // Áî≤/Â∑± -> Áî≤, ‰πô/Â∫ö -> ‰∏ô, ‰∏ô/Ëæõ -> Êàä, ‰∏Å/Â£¨ -> Â∫ö, Êàä/Áô∏ -> Â£¨
    const ziStart = {
      1:1, 6:1,
      2:3, 7:3,
      3:5, 8:5,
      4:7, 9:7,
      5:9, 10:9
    }[dayStemIndex];

    const hb = hourBranchIndex(hour);               // 1..12
    const hs = ((ziStart - 1 + (hb - 1)) % 10) + 1; // 1..10
    return { stemIndex: hs, branchIndex: hb, pillar: STEMS[hs-1] + BRANCHES[hb-1] };
  }

  function pad2(n){ return String(n).padStart(2, "0"); }

  // ---- UI ----
  const birthDate = document.getElementById("birthDate");
  const birthTime = document.getElementById("birthTime");
  const out = document.getElementById("out");
  const calcBtn = document.getElementById("calcBtn");
  const resetBtn = document.getElementById("resetBtn");

  function renderError(msg){
    out.style.display = "block";
    out.innerHTML = `<div style="color:#ffd6d6;font-weight:800;">${msg}</div>`;
  }

  function calculate(){
    const dateStr = birthDate.value;
    const timeStr = birthTime.value;

    out.style.display = "none";
    out.innerHTML = "";

    if (!dateStr){
      renderError("Please enter a birth date.");
      return;
    }

    const [yy, mm, dd] = dateStr.split("-").map(Number);
    const y = yy, m = mm, d = dd;

    let hour = null;
    if (timeStr){
      hour = Number(timeStr.split(":")[0]);
    }

    const day = dayPillarFromDate(y, m, d);
    const info = dayMasterInfo(day.stemIndex);
    const dayStem = STEMS[day.stemIndex - 1];

    let hourBlock = "";
    if (hour !== null){
      const hp = hourPillar(day.stemIndex, hour);
      hourBlock = `
        <div class="detail-grid">
          <div>Hour Pillar: <span class="mono">${hp.pillar}</span></div>
          <div style="color:var(--muted2);font-size:12px;">Hour Branch rule: Zi (23‚Äì01), Chou (01‚Äì03) ‚Ä¶ Hai (21‚Äì23)</div>
        </div>
      `;
    }

    out.innerHTML = `
      <div class="bigline">
        <div>
          <p class="big">${info.emoji} ${info.element}</p>
          <div class="subbig">Day Master: <span class="mono">${info.label}</span> (${info.roman} ¬∑ <span class="mono">${info.han}</span>)</div>
        </div>
        <span class="pill">Day Stem: <span class="mono">${dayStem}</span></span>
      </div>

      <details>
        <summary>Show details</summary>
        <div class="detail-grid">
          <div>Day Pillar (Stem+Branch): <span class="mono">${day.pillar}</span></div>
          ${hourBlock}
          <div style="color:var(--muted2);font-size:12px;">Calculated date: ${y}-${pad2(m)}-${pad2(d)}</div>
        </div>
      </details>
    `;
    out.style.display = "block";
  }

  function resetAll(){
    birthDate.value = "";
    birthTime.value = "";
    out.style.display = "none";
    out.innerHTML = "";
  }

  calcBtn.addEventListener("click", calculate);
  resetBtn.addEventListener("click", resetAll);

  // Auto-calc on change (nice on mobile)
  birthDate.addEventListener("change", () => { if (birthDate.value) calculate(); });
  birthTime.addEventListener("change", () => { if (birthDate.value) calculate(); });
</script>
</body>
</html>
