<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¤í–‰(ëª©Â·í™”Â·í† Â·ê¸ˆÂ·ìˆ˜) ë¹ ë¥¸ í™•ì¸</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; }
    body { margin: 0; background:#0b0c10; color:#eaf0ff; }
    .wrap { max-width: 760px; margin: 0 auto; padding: 24px; }
    .card { background:#121420; border:1px solid #22263a; border-radius:16px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { font-size: 20px; margin: 0 0 10px; }
    p { margin: 8px 0; line-height: 1.45; color:#cbd6ff; }
    label { display:block; font-size: 13px; color:#cbd6ff; margin: 14px 0 6px; }
    input, button { font-size: 15px; }
    input[type="date"], input[type="time"]{
      width: 100%; padding: 12px 12px; border-radius: 12px;
      border:1px solid #2a2f48; background:#0f1120; color:#eaf0ff;
      outline: none;
    }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 640px){ .row { grid-template-columns: 1fr; } }
    .checks { margin-top: 12px; display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .checks input { transform: translateY(1px); }
    button{
      margin-top: 14px; width:100%; padding: 12px 14px; border-radius: 12px;
      border:1px solid #2a2f48; background:#1a1f35; color:#eaf0ff; cursor:pointer;
    }
    button:hover{ filter: brightness(1.08); }
    .result { margin-top: 14px; padding: 14px; border-radius: 14px; border:1px dashed #2a2f48; background:#0f1120; }
    .big { font-size: 22px; font-weight: 750; letter-spacing: .2px; }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; border:1px solid #2a2f48; background:#0b0c10; margin-left: 8px; font-size: 13px; color:#cbd6ff; }
    .muted { color:#9fb0e8; font-size: 13px; }
    .mini { font-size: 14px; color:#cbd6ff; }
    .grid { display:grid; gap: 6px; margin-top: 8px; }
    .hr { height:1px; background:#22263a; margin: 12px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ìƒë…„ì›”ì¼(ï¼‹ì‹œê°„)ë¡œ ì˜¤í–‰(ëª©Â·ë¶ˆÂ·í† Â·ê¸ˆÂ·ë¬¼) í™•ì¸</h1>
      <p class="muted">
        ê¸°ì¤€: <b>ì¼ê°„(íƒœì–´ë‚œ â€œë‚ â€ì˜ ì²œê°„)</b> â†’ ì˜¤í–‰ìœ¼ë¡œ ë³€í™˜.
        ì‹œê°„ì€ <b>ì‹œì£¼(ì˜µì…˜)</b> í‘œì‹œì™€ â€˜ìì‹œ(23ì‹œ) ì²˜ë¦¬â€™ì—ë§Œ ì‚¬ìš©.
      </p>

      <div class="row">
        <div>
          <label for="birthDate">ìƒë…„ì›”ì¼</label>
          <input id="birthDate" type="date" />
        </div>
        <div>
          <label for="birthTime">íƒœì–´ë‚œ ì‹œê°„ (ì„ íƒ)</label>
          <input id="birthTime" type="time" />
        </div>
      </div>

      <div class="checks">
        <label style="display:flex; gap:8px; align-items:center; margin:0;">
          <input id="ziAsNextDay" type="checkbox" />
          ìì‹œ(23:00â€“23:59)ëŠ” â€œë‹¤ìŒ ë‚ â€ë¡œ ê³„ì‚°
        </label>
        <label style="display:flex; gap:8px; align-items:center; margin:0;">
          <input id="showHourPillar" type="checkbox" checked />
          ì‹œê°„ ì…ë ¥ ì‹œ ì‹œì£¼(ì‹œì²œê°„+ì‹œì§€)ë„ í‘œì‹œ
        </label>
      </div>

      <button id="calcBtn">ê³„ì‚°í•˜ê¸°</button>

      <div id="out" class="result" style="display:none;"></div>

      <div class="hr"></div>
      <p class="muted">
        ì°¸ê³ : ì •í†µ ì‚¬ì£¼(ì›”ì£¼/ì—°ì£¼)ëŠ” <b>ì ˆê¸°(ì…ì ˆ)</b>Â·ì¶œìƒì§€ ê²½ë„Â·í‘œì¤€ì‹œ ë“±ì„ ë°˜ì˜í•´ì•¼ í•´ì„œ
        â€œì™„ì „ ì •í™• ë²„ì „â€ì€ ê³„ì‚°ì´ ë” ì»¤ì ¸ìš”. ì´ í˜ì´ì§€ëŠ” â€œê°„ë‹¨í•˜ê²Œ ë‚´ ì˜¤í–‰(ì¼ê°„)â€ë§Œ ë¹ ë¥´ê²Œ ë³´ëŠ” MVPì˜ˆìš”.
      </p>
    </div>
  </div>

<script>
  // --- ê¸°ë³¸ ë°ì´í„° ---
  const STEMS = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
  const BRANCHES = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];

  function mod(n, m){ return ((n % m) + m) % m; }

  // Gregorian date -> Julian Day Number at noon (integer)
  // (í‘œì¤€ ì•Œê³ ë¦¬ì¦˜: JDNì€ ì •ì˜¤ ê¸°ì¤€ ì •ìˆ˜)
  function jdnNoon(y, m, d){
    const a = Math.floor((14 - m) / 12);
    const y2 = y + 4800 - a;
    const m2 = m + 12 * a - 3;
    return d
      + Math.floor((153 * m2 + 2) / 5)
      + 365 * y2
      + Math.floor(y2 / 4)
      - Math.floor(y2 / 100)
      + Math.floor(y2 / 400)
      - 32045;
  }

  function addDaysUTC(y, m, d, delta){
    const dt = new Date(Date.UTC(y, m - 1, d));
    dt.setUTCDate(dt.getUTCDate() + delta);
    return [dt.getUTCFullYear(), dt.getUTCMonth() + 1, dt.getUTCDate()];
  }

  // Sexagenary day stem/branch from JD_noon:
  // T = 1 + mod(JD_noon - 1, 10)
  // B = 1 + mod(JD_noon + 1, 12)
  function dayPillarFromDate(y, m, d){
    const jd = jdnNoon(y, m, d);
    const T = 1 + mod(jd - 1, 10);
    const B = 1 + mod(jd + 1, 12);
    return { jd, stemIndex: T, branchIndex: B, pillar: STEMS[T-1] + BRANCHES[B-1] };
  }

  function elementFromStemIndex(T){
    if (T === 1 || T === 2) return { ko:"ëª©", emoji:"ğŸŒ³" };
    if (T === 3 || T === 4) return { ko:"ë¶ˆ", emoji:"ğŸ”¥" };
    if (T === 5 || T === 6) return { ko:"í† ", emoji:"ğŸª¨" };
    if (T === 7 || T === 8) return { ko:"ê¸ˆ", emoji:"ğŸª™" };
    return { ko:"ë¬¼", emoji:"ğŸ’§" }; // 9,10
  }

  function hourBranchIndex(hour){
    // 23:00â€“00:59 => å­, 01â€“02 => ä¸‘ ... 21â€“22 => äº¥
    if (hour === 23 || hour === 0) return 1;
    return ((hour + 1) >> 1) + 1; // 1..22 -> 2..12
  }

  function hourPillar(dayStemIndex, hour){
    // 5 Rat method (table ê¸°ë°˜): Zi hour stem depends on day stem.
    // ç”²/å·± -> ç”², ä¹™/åºš -> ä¸™, ä¸™/è¾› -> æˆŠ, ä¸/å£¬ -> åºš, æˆŠ/ç™¸ -> å£¬
    const ziStart = {
      1:1, 6:1,
      2:3, 7:3,
      3:5, 8:5,
      4:7, 9:7,
      5:9, 10:9
    }[dayStemIndex];

    const hb = hourBranchIndex(hour); // 1..12
    const hs = ( (ziStart - 1 + (hb - 1)) % 10 ) + 1; // 1..10
    return { stemIndex: hs, branchIndex: hb, pillar: STEMS[hs-1] + BRANCHES[hb-1] };
  }

  function pad2(n){ return String(n).padStart(2, "0"); }

  document.getElementById("calcBtn").addEventListener("click", () => {
    const dateStr = document.getElementById("birthDate").value;
    const timeStr = document.getElementById("birthTime").value;
    const ziAsNextDay = document.getElementById("ziAsNextDay").checked;
    const showHour = document.getElementById("showHourPillar").checked;

    const out = document.getElementById("out");
    out.style.display = "none";
    out.innerHTML = "";

    if (!dateStr){
      out.style.display = "block";
      out.innerHTML = `<div class="mini">ìƒë…„ì›”ì¼ì„ ë¨¼ì € ì…ë ¥í•´ì¤˜.</div>`;
      return;
    }

    let [y, m, d] = dateStr.split("-").map(Number);

    let hour = null, minute = null;
    if (timeStr){
      [hour, minute] = timeStr.split(":").map(Number);
      // ì˜µì…˜: 23ì‹œëŒ€ë¥¼ ë‹¤ìŒë‚ ë¡œ ì²˜ë¦¬
      if (ziAsNextDay && hour === 23){
        [y, m, d] = addDaysUTC(y, m, d, 1);
      }
    }

    const day = dayPillarFromDate(y, m, d);
    const dayStem = STEMS[day.stemIndex - 1];
    const el = elementFromStemIndex(day.stemIndex);

    let html = `
      <div class="big">
        ì˜¤í–‰: ${el.emoji} ${el.ko}
        <span class="pill">ì¼ê°„ ${dayStem}</span>
      </div>
      <div class="grid">
        <div class="mini">ì¼ì£¼(ì¼ê°„+ì¼ì§€): <b>${day.pillar}</b></div>
        <div class="mini muted">ê³„ì‚° ê¸°ì¤€ ë‚ ì§œ: ${y}-${pad2(m)}-${pad2(d)} (ì •ì˜¤ JD: ${day.jd})</div>
      </div>
    `;

    if (showHour && hour !== null){
      const hp = hourPillar(day.stemIndex, hour);
      html += `
        <div class="hr"></div>
        <div class="mini">ì‹œì£¼(ì˜µì…˜): <b>${hp.pillar}</b> <span class="pill">${hour}ì‹œëŒ€</span></div>
        <div class="muted">ì‹œì§€ ê¸°ì¤€: å­(23â€“01), ä¸‘(01â€“03) â€¦ äº¥(21â€“23)</div>
      `;
    }

    out.innerHTML = html;
    out.style.display = "block";
  });
</script>
</body>
</html>
